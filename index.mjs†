cd /Users/rodrigo/Projects/locione-telegram-bot
nano index.mjsimport { Telegraf, Markup } from "telegraf";
import "dotenv/config";

const bot = new Telegraf(process.env.BOT_TOKEN);

// Links oficiais
const LINKS = {
  finance_ios: "https://apps.apple.com/it/app/locione-finance/id6758838032",
  desk_download: "https://locione.com/download",
  site: "https://locione.com",
  canal: "https://t.me/locione_app",
};

// Menu principal
function mainMenu() {
  return Markup.inlineKeyboard([
    [Markup.button.callback("ðŸ“± LociOne Finance", "app_finance")],
    [Markup.button.callback("ðŸ’» LociOne Desk", "app_desk")],
    [Markup.button.url("ðŸŒ Site oficial", LINKS.site)],
    [Markup.button.url("ðŸ“£ Canal de novidades", LINKS.canal)],
  ]);
}

async function showFinance(ctx) {
  const text =
    "*LociOne Finance ðŸ“±*\n\n" +
    "â€¢ Controle financeiro rÃ¡pido\n" +
    "â€¢ Offline-first (dados no aparelho)\n" +
    "â€¢ RelatÃ³rios e organizaÃ§Ã£o\n\n" +
    "Baixe no iOS:";
  const kb = Markup.inlineKeyboard([
    [Markup.button.url("ðŸŽ App Store (iOS)", LINKS.finance_ios)],
    [Markup.button.callback("â¬…ï¸ Voltar", "back")],
  ]);

  // ctx pode ser message ou callback
  if ("editMessageText" in ctx) return ctx.editMessageText(text, { parse_mode: "Markdown", ...kb });
  return ctx.reply(text, { parse_mode: "Markdown", ...kb });
}

async function showDesk(ctx) {
  const text =
    "*LociOne Desk ðŸ’»*\n\n" +
    "â€¢ App desktop offline-first\n" +
    "â€¢ Produtividade com privacidade\n" +
    "â€¢ Downloads oficiais no site\n\n" +
    "FaÃ§a o download:";
  const kb = Markup.inlineKeyboard([
    [Markup.button.url("ðŸ’» Download Desktop", LINKS.desk_download)],
    [Markup.button.callback("â¬…ï¸ Voltar", "back")],
  ]);

  if ("editMessageText" in ctx) return ctx.editMessageText(text, { parse_mode: "Markdown", ...kb });
  return ctx.reply(text, { parse_mode: "Markdown", ...kb });
}

// /start (com deep link payload)
bot.start(async (ctx) => {
  const payload = (ctx.startPayload || "").trim();

  if (payload === "finance") return showFinance(ctx);
  if (payload === "desk") return showDesk(ctx);

  return ctx.reply(
    "ðŸ‘‹ *Bem-vindo Ã  LociOne!*\n\nEscolha o app que vocÃª quer conhecer:",
    { parse_mode: "Markdown", ...mainMenu() }
  );
});

// Comandos
bot.command("finance", (ctx) => showFinance(ctx));
bot.command("desk", (ctx) => showDesk(ctx));
bot.command("site", (ctx) => ctx.reply(`ðŸŒ Site oficial: ${LINKS.site}`));
bot.command("canal", (ctx) => ctx.reply(`ðŸ“£ Canal de novidades: ${LINKS.canal}`));

// BotÃµes
bot.action("app_finance", (ctx) => showFinance(ctx));
bot.action("app_desk", (ctx) => showDesk(ctx));
bot.action("back", (ctx) =>
  ctx.editMessageText("Escolha o app que vocÃª quer conhecer:", mainMenu())
);

// Erros
bot.catch((err) => console.error("Bot error:", err));

// Start
bot.launch();
console.log("ðŸ¤– LociOne Bot rodando (polling)...");
console.log("Deep links:");
console.log(" - https://t.me/locione_bot?start=finance");
console.log(" - https://t.me/locione_bot?start=desk");

// Encerramento limpo
process.once("SIGINT", () => bot.stop("SIGINT"));
process.once("SIGTERM", () => bot.stop("SIGTERM"));
